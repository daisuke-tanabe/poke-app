# 要件定義書

## データベース設計の前提・制約

- ポケモンは何匹でも登録できる必要があります
- ポケモンは次の通りに図鑑に属しています
    - すべてのポケモンは必ず全国図鑑に属しています
    - すべてのポケモンは必ず1つ以上の地域別の図鑑に属します
- ポケモンは炎や水などのタイプを必ず1つ以上持ちます
- 【制約】ポケモンを削除した場合、関連する図鑑エントリ（PokedexEntry）およびタイプエントリ（TypeEntry）も自動的に削除されます（ON DELETE CASCADE）

## 主要な機能

- ポケモンの一覧
  - 図鑑ごとにポケモンを絞り込める必要があります
  - タイプごとにポケモンを絞り込める必要があります
  - ポケモンの名前で検索できるようにする必要があります
- ポケモンの詳細な情報
  - 日本語名
  - 英語名
  - ローマ名
  - 所属する図鑑
  - タイプ
  - 体重
  - 身長

## 非機能要件

- 対応ブラウザは以下の通りです。バージョンは直前のメジャーバージョンの2つ前を保証してください
  - Google Chrome
  - Edge
  - Safari / iOS Safari
  - Android

## 開発・運用環境

- プログラミング言語は TypeScript v5 の latest を使います
- フレームワークは Next.js v15 の latest を使います
  - データアクセスレイヤーを追加してサーバーコンポーネントからデータアクセスレイヤーを介してデータベースを操作します
- バックエンド
  - 実行環境は Node.js の v22 の latest を使います
  - データベースは PostgreSQL の v17の latest を使います
  - ORMは Prisma の v6 の latest を使います

## ポケモン検索機能の要件

### 検索UI
- 図鑑名、タイプ1、タイプ2、名前の4つの条件で検索できる。
- 図鑑名は階層構造のセレクトボックスで選択。
  - 地方は非選択項目です
  - 図鑑は地方ごとにグループでまとまっています。
  - 初期値は「全国」です。
- タイプ1・タイプ2はそれぞれセレクトボックスで選択（初期値は「すべて」）。
  - ラベルは「タイプ1を選択」「タイプ2を選択」。
- 名前はテキストフィールドで入力（初期値は空）。
  - ラベルは「名前を入力」。
- 検索ボタンを押下したときのみ検索が実行される。

### 検索ロジック
- 図鑑名・タイプ1・タイプ2・名前の全ての条件がANDで適用される。
- タイプ1・タイプ2の仕様：
  - どちらか一方のみ指定、または同じ値の場合：「そのタイプを1つ以上持つ」ポケモン全てが対象。
  - 両方指定かつ異なる場合：「両方のタイプを持つ」ポケモンのみが対象（順不同）。
- 名前は日本語・英語・カナのいずれかに部分一致する場合にヒットする。
- ページネーション対応（1ページ20件）。

### その他
- 検索条件はURLクエリパラメータに反映される。
- 検索結果リストとページャーが表示される。

## ポケモン検索結果要件

### カードUI
- 名前（日本語・英語）を表示する
- 全国図鑑の番号を表示する。
- タイプ別で色分けされたバッジを表示する。
- 所属する地方図鑑の名前と番号を同じバッジで表示する。
- 図鑑番号の接頭辞には半角シャープをつける。

### データ取得・表示仕様
- 検索結果の各ポケモンには、必ず「全国図鑑」と「所属する地方図鑑」の両方の図鑑エントリ（番号・図鑑名）が含まれること。
  - 全国図鑑（pokedex_id=1）は必須。地方図鑑は1つ以上必須。
  - 各図鑑エントリには図鑑名（日本語名）・図鑑番号・slugが含まれること。
- 検索条件が全国図鑑の場合も、地方図鑑エントリを除外せず全て含めて返すこと。
- フロントエンドでは、全国図鑑番号は「全国図鑑」バッジとして、地方図鑑は「地方図鑑名＋番号」バッジとしてそれぞれ表示すること。
- 図鑑名はIDやslugではなく、必ず日本語名（例：「カントー図鑑」など）を表示すること。

### UI/UX
- 検索結果カードには、以下の情報を必ず表示すること
  - 日本語名・英語名
  - 全国図鑑番号（「#」付き、全国図鑑バッジとして）
  - 所属する地方図鑑名＋番号（バッジとして、複数ある場合は全て表示）
  - タイプバッジ（色分け）
- 図鑑名や番号が正しく表示されていない場合はバグとみなす。